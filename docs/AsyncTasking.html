<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Taskflow Handbook</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/x-icon" href="favicon.ico" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="taskflow_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="https://taskflow.github.io/">Taskflow</a>
   &#160;<span id="projectnumber">3.2.0-Master-Branch</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('AsyncTasking.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Asynchronous Tasking</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#LaunchAsynchronousTasksFromAnExecutor">Launch Asynchronous Tasks from an Executor</a></li>
<li class="level1"><a href="#LaunchAsynchronousTasksFromAnSubflow">Launch Asynchronous Tasks from a Subflow</a></li>
</ul>
</div>
<div class="textblock"><p>This chapters discusses how to launch tasks asynchronously so that you can incorporate independent, dynamic parallelism in your taskflows.</p>
<h1><a class="anchor" id="LaunchAsynchronousTasksFromAnExecutor"></a>
Launch Asynchronous Tasks from an Executor</h1>
<p>Taskflow executor provides a STL-styled method, <a class="el" href="classtf_1_1Executor.html#a1e6866c8f1b6a2e932f06d0b4eb032c0" title="runs a given function asynchronously">tf::Executor::async</a>, for you to run a callable object asynchronously. The method returns a <a class="el" href="classtf_1_1Future.html" title="class to access the result of an execution">tf::Future</a> object derived from <a href="https://en.cppreference.com/w/cpp/thread/future">std::future</a> that will eventually hold the result of that function call. The result may be optional due to <a class="el" href="classtf_1_1Future.html#a3bf5f104864ab2590b6409712d3a469b" title="cancels the execution of the running taskflow associated with this future object">tf::Future::cancel</a> (see <a class="el" href="RequestCancellation.html">Request Cancellation</a> for details).</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1Future.html">tf::Future&lt;std::optional&lt;int&gt;</a>&gt; future = executor.async([](){ <span class="keywordflow">return</span> 1; });</div>
<div class="line">executor.wait_for_all();</div>
<div class="line">assert(future.get() == 1);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classtf_1_1Future.html">tf::Future&lt;void&gt;</a> future_of_void_return = executor.async([](){});</div>
<div class="line">future_of_void_return.get();</div>
<div class="ttc" id="aclasstf_1_1Future_html"><div class="ttname"><a href="classtf_1_1Future.html">tf::Future</a></div><div class="ttdoc">class to access the result of an execution</div><div class="ttdef"><b>Definition</b> core/taskflow.hpp:571</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The future object returned from <a class="el" href="classtf_1_1Executor.html#a1e6866c8f1b6a2e932f06d0b4eb032c0" title="runs a given function asynchronously">tf::Executor::async</a> does not block on destruction.</dd></dl>
<p>If you do not need the return value or the future, you can use <a class="el" href="classtf_1_1Executor.html#abf71e7ec0026ddfce79c912264369bc9" title="similar to tf::Executor::async but does not return a future object">tf::Executor::silent_async</a> which has less overhead of creating an asynchronous task compared to <a class="el" href="classtf_1_1Executor.html#a1e6866c8f1b6a2e932f06d0b4eb032c0" title="runs a given function asynchronously">tf::Executor::async</a>.</p>
<div class="fragment"><div class="line">executor.silent_async([](){</div>
<div class="line">  <span class="comment">// just do some stuff in the background ...</span></div>
<div class="line">});</div>
</div><!-- fragment --><p>Launching asynchronous tasks from an executor is <em>thread-safe</em> and can be called from multiple threads or from the execution of a task. Our scheduler autonomously detects whether an asynchronous task is submitted from an external thread or a worker thread and schedules its execution in an efficient work-stealing loop.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> my_task = taskflow.emplace([&amp;](){</div>
<div class="line">  <span class="comment">// do some stuff</span></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  <span class="comment">// launch an asynchronous task from my_task</span></div>
<div class="line">  executor.async([&amp;](){</div>
<div class="line">    <span class="comment">// do another asynchronous work</span></div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">    <span class="comment">// launch another asynchronous task</span></div>
<div class="line">    executor.async([&amp;](){});</div>
<div class="line">  })</div>
<div class="line">});</div>
<div class="line">executor.run(taskflow);</div>
<div class="line">executor.wait_for_all();   <span class="comment">// wait for all tasks to finish</span></div>
<div class="ttc" id="aclasstf_1_1Task_html"><div class="ttname"><a href="classtf_1_1Task.html">tf::Task</a></div><div class="ttdoc">class to create a task handle over a node in a taskflow graph</div><div class="ttdef"><b>Definition</b> task.hpp:187</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Asynchronous tasks created from an executor does not belong to any taskflows.</dd></dl>
<p>You can name an asynchronous task to facilitate profiling by using the methods <a class="el" href="classtf_1_1Executor.html#a51acee1670e9f246c7ccd7f6a63f1524" title="runs a given function asynchronously and gives a name to this task">tf::Executor::named_async</a> and <a class="el" href="classtf_1_1Executor.html#a1febfaa7a99cac8466263c58fd2a7c06" title="similar to tf::Executor::named_async but does not return a future object">tf::Executor::named_silent_async</a>.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1Future.html">tf::Future&lt;void&gt;</a> future = executor.named_async(<span class="stringliteral">&quot;name of the task&quot;</span>, [](){});</div>
<div class="line">executor.silent_named_async(<span class="stringliteral">&quot;another name of the task&quot;</span>, [](){});</div>
</div><!-- fragment --><h1><a class="anchor" id="LaunchAsynchronousTasksFromAnSubflow"></a>
Launch Asynchronous Tasks from a Subflow</h1>
<p>You can launch asynchronous tasks from a subflow (<a class="el" href="classtf_1_1Subflow.html" title="class to construct a subflow graph from the execution of a dynamic task">tf::Subflow</a>) using <a class="el" href="classtf_1_1Subflow.html#a70681068507b224a96df69cc1f3168f1" title="runs a given function asynchronously">tf::Subflow::async</a>. Asynchronous tasks created from a subflow are, and <em>only</em>, used with <em>join</em> (<a class="el" href="classtf_1_1Subflow.html#a59fcac1323e70d920088dd37bd0be245" title="enables the subflow to join its parent task">tf::Subflow::join</a>) to describe independent tasks that are dynamically spawned during the execution of that subflow. When the subflow joins, all asynchronous tasks are guaranteed to finish. The following code creates 100 asynchronous tasks from a subflow, and these asynchronous tasks will complete by the time the subflow joins.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1Taskflow.html">tf::Taskflow</a> taskflow;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1Executor.html">tf::Executor</a> executor;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/atomic/atomic.html">std::atomic&lt;int&gt;</a> counter{0};</div>
<div class="line"> </div>
<div class="line">taskflow.<a class="code hl_function" href="classtf_1_1FlowBuilder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([&amp;] (<a class="code hl_class" href="classtf_1_1Subflow.html">tf::Subflow</a>&amp; sf){</div>
<div class="line">  <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;tf::Future&lt;void&gt;</a>&gt; futures;</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;100; i++) {</div>
<div class="line">    futures.emplace_back(sf.<a class="code hl_function" href="classtf_1_1Subflow.html#a70681068507b224a96df69cc1f3168f1">async</a>([&amp;](){ ++counter; }));</div>
<div class="line">  }</div>
<div class="line">  sf.<a class="code hl_function" href="classtf_1_1Subflow.html#a59fcac1323e70d920088dd37bd0be245">join</a>();  <span class="comment">// all of the 100 asynchronous tasks will finish by this join</span></div>
<div class="line">  assert(counter == 100);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">executor.<a class="code hl_function" href="classtf_1_1Executor.html#a519777f5783981d534e9e53b99712069">run</a>(taskflow).wait();</div>
<div class="ttc" id="aatomic_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/atomic/atomic.html">std::atomic</a></div></div>
<div class="ttc" id="aclasstf_1_1Executor_html"><div class="ttname"><a href="classtf_1_1Executor.html">tf::Executor</a></div><div class="ttdoc">class to create an executor for running a taskflow graph</div><div class="ttdef"><b>Definition</b> executor.hpp:50</div></div>
<div class="ttc" id="aclasstf_1_1Executor_html_a519777f5783981d534e9e53b99712069"><div class="ttname"><a href="classtf_1_1Executor.html#a519777f5783981d534e9e53b99712069">tf::Executor::run</a></div><div class="ttdeci">tf::Future&lt; void &gt; run(Taskflow &amp;taskflow)</div><div class="ttdoc">runs a taskflow once</div><div class="ttdef"><b>Definition</b> executor.hpp:1573</div></div>
<div class="ttc" id="aclasstf_1_1FlowBuilder_html_a60d7a666cab71ecfa3010b2efb0d6b57"><div class="ttname"><a href="classtf_1_1FlowBuilder.html#a60d7a666cab71ecfa3010b2efb0d6b57">tf::FlowBuilder::emplace</a></div><div class="ttdeci">Task emplace(C &amp;&amp;callable)</div><div class="ttdoc">creates a static task</div><div class="ttdef"><b>Definition</b> flow_builder.hpp:742</div></div>
<div class="ttc" id="aclasstf_1_1Subflow_html"><div class="ttname"><a href="classtf_1_1Subflow.html">tf::Subflow</a></div><div class="ttdoc">class to construct a subflow graph from the execution of a dynamic task</div><div class="ttdef"><b>Definition</b> flow_builder.hpp:889</div></div>
<div class="ttc" id="aclasstf_1_1Subflow_html_a59fcac1323e70d920088dd37bd0be245"><div class="ttname"><a href="classtf_1_1Subflow.html#a59fcac1323e70d920088dd37bd0be245">tf::Subflow::join</a></div><div class="ttdeci">void join()</div><div class="ttdoc">enables the subflow to join its parent task</div><div class="ttdef"><b>Definition</b> executor.hpp:1826</div></div>
<div class="ttc" id="aclasstf_1_1Subflow_html_a70681068507b224a96df69cc1f3168f1"><div class="ttname"><a href="classtf_1_1Subflow.html#a70681068507b224a96df69cc1f3168f1">tf::Subflow::async</a></div><div class="ttdeci">auto async(F &amp;&amp;f, ArgsT &amp;&amp;... args)</div><div class="ttdoc">runs a given function asynchronously</div><div class="ttdef"><b>Definition</b> executor.hpp:1908</div></div>
<div class="ttc" id="aclasstf_1_1Taskflow_html"><div class="ttname"><a href="classtf_1_1Taskflow.html">tf::Taskflow</a></div><div class="ttdoc">class to create a taskflow object</div><div class="ttdef"><b>Definition</b> core/taskflow.hpp:73</div></div>
<div class="ttc" id="avector_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector</a></div></div>
</div><!-- fragment --><p>If you do not need the return value or the future, you can use <a class="el" href="classtf_1_1Subflow.html#af9671aa8548882b3425e5a1f10f7a868" title="similar to tf::Subflow::async but does not return a future object">tf::Subflow::silent_async</a> which has less overhead of creating an asynchronous task compared to <a class="el" href="classtf_1_1Subflow.html#a70681068507b224a96df69cc1f3168f1" title="runs a given function asynchronously">tf::Subflow::async</a>.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1Taskflow.html">tf::Taskflow</a> taskflow;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1Executor.html">tf::Executor</a> executor;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/atomic/atomic.html">std::atomic&lt;int&gt;</a> counter{0};</div>
<div class="line"> </div>
<div class="line">taskflow.<a class="code hl_function" href="classtf_1_1FlowBuilder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([&amp;] (<a class="code hl_class" href="classtf_1_1Subflow.html">tf::Subflow</a>&amp; sf){</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;100; i++) {</div>
<div class="line">    sf.<a class="code hl_function" href="classtf_1_1Subflow.html#af9671aa8548882b3425e5a1f10f7a868">silent_async</a>([&amp;](){ ++counter; });</div>
<div class="line">  }</div>
<div class="line">  sf.<a class="code hl_function" href="classtf_1_1Subflow.html#a59fcac1323e70d920088dd37bd0be245">join</a>();  <span class="comment">// all of the 100 asynchronous tasks will finish by this join</span></div>
<div class="line">  assert(counter == 100);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">executor.<a class="code hl_function" href="classtf_1_1Executor.html#a519777f5783981d534e9e53b99712069">run</a>(taskflow).wait();</div>
<div class="ttc" id="aclasstf_1_1Subflow_html_af9671aa8548882b3425e5a1f10f7a868"><div class="ttname"><a href="classtf_1_1Subflow.html#af9671aa8548882b3425e5a1f10f7a868">tf::Subflow::silent_async</a></div><div class="ttdeci">void silent_async(F &amp;&amp;f, ArgsT &amp;&amp;... args)</div><div class="ttdoc">similar to tf::Subflow::async but does not return a future object</div><div class="ttdef"><b>Definition</b> executor.hpp:1944</div></div>
</div><!-- fragment --><p>Creating asynchronous tasks from a subflow allows users to describe, for example, recursive algorithms that define only division without conquering or merging (e.g., parallel quick sort).</p>
<dl class="section attention"><dt>Attention</dt><dd>You should only create asynchronous tasks from a joined subflow. Launching asynchronous tasks from a detached subflow results in undefined behavior.</dd></dl>
<p>Similar to <a class="el" href="classtf_1_1Executor.html#a51acee1670e9f246c7ccd7f6a63f1524" title="runs a given function asynchronously and gives a name to this task">tf::Executor::named_async</a> and <a class="el" href="classtf_1_1Executor.html#a1febfaa7a99cac8466263c58fd2a7c06" title="similar to tf::Executor::named_async but does not return a future object">tf::Executor::named_silent_async</a>, you can name an asynchronous task in <a class="el" href="classtf_1_1Subflow.html" title="class to construct a subflow graph from the execution of a dynamic task">tf::Subflow</a> to facilitate profiling by using the methods <a class="el" href="classtf_1_1Subflow.html#ae528c2de98ec89afc50b8815c0306b5e" title="runs the given function asynchronously and assigns the task a name">tf::Subflow::named_async</a> and <a class="el" href="classtf_1_1Subflow.html#a3290b8f729c4511f2023199e4c067951" title="similar to tf::Subflow::named_async but does not return a future object">tf::Subflow::named_silent_async</a>.</p>
<div class="fragment"><div class="line">taskflow.<a class="code hl_function" href="classtf_1_1FlowBuilder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([](<a class="code hl_class" href="classtf_1_1Subflow.html">tf::Subflow</a>&amp; sf){</div>
<div class="line">  <a class="code hl_class" href="classtf_1_1Future.html">tf::Future&lt;void&gt;</a> future = sf.<a class="code hl_function" href="classtf_1_1Subflow.html#ae528c2de98ec89afc50b8815c0306b5e">named_async</a>(<span class="stringliteral">&quot;name of the task&quot;</span>, [](){});</div>
<div class="line">  sf.silent_named_async(<span class="stringliteral">&quot;another name of the task&quot;</span>, [](){});</div>
<div class="line">  sf.<a class="code hl_function" href="classtf_1_1Subflow.html#a59fcac1323e70d920088dd37bd0be245">join</a>();</div>
<div class="line">});</div>
<div class="ttc" id="aclasstf_1_1Subflow_html_ae528c2de98ec89afc50b8815c0306b5e"><div class="ttname"><a href="classtf_1_1Subflow.html#ae528c2de98ec89afc50b8815c0306b5e">tf::Subflow::named_async</a></div><div class="ttdeci">auto named_async(const std::string &amp;name, F &amp;&amp;f, ArgsT &amp;&amp;... args)</div><div class="ttdoc">runs the given function asynchronously and assigns the task a name</div><div class="ttdef"><b>Definition</b> executor.hpp:1854</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Cookbook.html">Cookbook</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
