<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Taskflow Handbook</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/x-icon" href="favicon.ico" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="taskflow_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="https://taskflow.github.io/">Taskflow</a>
   &#160;<span id="projectnumber">3.2.0-Master-Branch</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('TaskflowProcessingPipeline.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Taskflow Processing Pipeline</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#FormulateTheTaskflowProcessingPipelineProblem">Formulate the Taskflow Processing Pipeline Problem</a></li>
<li class="level1"><a href="#CreateATaskflowProcessingPipeline">Create a Taskflow Processing Pipeline</a><ul><li class="level2"><a href="#TaskflowPipelineDefineTaskflows">Define Taskflows</a></li>
<li class="level2"><a href="#TaskflowPipelineDefineThePipes">Define the Pipes</a></li>
<li class="level2"><a href="#TaskflowPipelineDefineTheTaskGraph">Define the Task Graph</a></li>
<li class="level2"><a href="#TaskflowPipelineSubmitTheTaskGraph">Submit the Task Graph</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>We study a taskflow processing pipeline that propagates a sequence of tokens through linearly dependent taskflows. The pipeline embeds a taskflow in each pipe to run a parallel algorithm using task graph parallelism.</p>
<h1><a class="anchor" id="FormulateTheTaskflowProcessingPipelineProblem"></a>
Formulate the Taskflow Processing Pipeline Problem</h1>
<p>Many complex and irregular pipeline applications require each pipe to run a parallel algorithm using task graph parallelism. We can formulate such applications as scheduling a sequence of tokens through linearly dependent taskflows. The following example illustrates the pipeline propagation of three scheduling tokens through three linearly dependent taskflows:</p>
<div class="dotgraph">
<img src="dot_taskflow_processing_pipeline_2.png" alt="dot_taskflow_processing_pipeline_2.png" border="0" usemap="#dot_taskflow_processing_pipeline_2.map"/>
</div>
 <div class="dotgraph">
<img src="dot_taskflow_processing_pipeline_1.png" alt="dot_taskflow_processing_pipeline_1.png" border="0" usemap="#dot_taskflow_processing_pipeline_1.map"/>
</div>
<p>Each pipe (stage) in the pipeline embeds a taskflow to perform a stage-specific parallel algorithm on an input scheduling token. Parallelism exhibits both inside and outside the three taskflows, combining both <em>task graph parallelism</em> and <em>pipeline parallelism</em>.</p>
<h1><a class="anchor" id="CreateATaskflowProcessingPipeline"></a>
Create a Taskflow Processing Pipeline</h1>
<p>Using the example from the previous section, we create a pipeline of three <em>serial</em> pipes each running a taskflow on a sequence of five scheduling tokens. The overall implementation is shown below:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="taskflow_8hpp.html">taskflow/taskflow.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pipeline_8hpp.html">taskflow/algorithm/pipeline.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// taskflow on the first pipe</span></div>
<div class="line"><span class="keywordtype">void</span> make_taskflow1(<a class="code hl_class" href="classtf_1_1Taskflow.html">tf::Taskflow</a>&amp; <a class="code hl_namespace" href="namespacetf.html">tf</a>) {</div>
<div class="line">  <span class="keyword">auto</span> [A1, B1, C1, D1] = <a class="code hl_namespace" href="namespacetf.html">tf</a>.emplace(</div>
<div class="line">    [](){ printf(<span class="stringliteral">&quot;A1\n&quot;</span>); },</div>
<div class="line">    [](){ printf(<span class="stringliteral">&quot;B1\n&quot;</span>); },</div>
<div class="line">    [](){ printf(<span class="stringliteral">&quot;C1\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;D1\n&quot;</span>); }</div>
<div class="line">  );</div>
<div class="line">  A1.precede(B1, C1);</div>
<div class="line">  D1.succeed(B1, C1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// taskflow on the second pipe</span></div>
<div class="line"><span class="keywordtype">void</span> make_taskflow2(<a class="code hl_class" href="classtf_1_1Taskflow.html">tf::Taskflow</a>&amp; <a class="code hl_namespace" href="namespacetf.html">tf</a>) {</div>
<div class="line">  <span class="keyword">auto</span> [A2, B2, C2, D2] = <a class="code hl_namespace" href="namespacetf.html">tf</a>.emplace(</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;A2\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;B2\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;C2\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;D2\n&quot;</span>); }</div>
<div class="line">  );</div>
<div class="line">  <a class="code hl_namespace" href="namespacetf.html">tf</a>.linearize({A2, B2, C2, D2});</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// taskflow on the third pipe</span></div>
<div class="line"><span class="keywordtype">void</span> make_taskflow3(<a class="code hl_class" href="classtf_1_1Taskflow.html">tf::Taskflow</a>&amp; <a class="code hl_namespace" href="namespacetf.html">tf</a>) {</div>
<div class="line">  <span class="keyword">auto</span> [A3, B3, C3, D3] = <a class="code hl_namespace" href="namespacetf.html">tf</a>.emplace(</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;A3\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;B3\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;C3\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;D3\n&quot;</span>); }</div>
<div class="line">  );</div>
<div class="line">  A3.precede(B3, C3, D3);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="classtf_1_1Taskflow.html">tf::Taskflow</a> taskflow(<span class="stringliteral">&quot;taskflow processing pipeline&quot;</span>);</div>
<div class="line">  <a class="code hl_class" href="classtf_1_1Executor.html">tf::Executor</a> executor;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_lines = 2;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_pipes = 3;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// define the taskflow storage</span></div>
<div class="line">  <span class="comment">// we use the pipe dimension because we create three &#39;serial&#39; pipes</span></div>
<div class="line">  <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/container/array.html">std::array&lt;tf::Taskflow, num_pipes&gt;</a> taskflows;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// create three different taskflows for the three pipes</span></div>
<div class="line">  make_taskflow1(taskflows[0]);</div>
<div class="line">  make_taskflow2(taskflows[1]);</div>
<div class="line">  make_taskflow3(taskflows[2]);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// the pipeline consists of three serial pipes</span></div>
<div class="line">  <span class="comment">// and up to two concurrent scheduling tokens</span></div>
<div class="line">  <a class="code hl_class" href="classtf_1_1Pipeline.html">tf::Pipeline</a> pl(num_lines,</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// first pipe runs taskflow1</span></div>
<div class="line">    <a class="code hl_class" href="classtf_1_1Pipe.html">tf::Pipe</a>{<a class="code hl_enumvalue" href="namespacetf.html#abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0">tf::PipeType::SERIAL</a>, [&amp;](<a class="code hl_class" href="classtf_1_1Pipeflow.html">tf::Pipeflow</a>&amp; pf) {</div>
<div class="line">      <span class="keywordflow">if</span>(pf.token() == 5) {</div>
<div class="line">        pf.stop();</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line">      <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;begin token %zu\n&quot;</span>, pf.token());</div>
<div class="line">      executor.<a class="code hl_function" href="classtf_1_1Executor.html#a519777f5783981d534e9e53b99712069">run</a>(taskflows[pf.pipe()]).wait();</div>
<div class="line">    }},</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// second pipe runs taskflow2</span></div>
<div class="line">    <a class="code hl_class" href="classtf_1_1Pipe.html">tf::Pipe</a>{<a class="code hl_enumvalue" href="namespacetf.html#abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0">tf::PipeType::SERIAL</a>, [&amp;](<a class="code hl_class" href="classtf_1_1Pipeflow.html">tf::Pipeflow</a>&amp; pf) {</div>
<div class="line">      executor.<a class="code hl_function" href="classtf_1_1Executor.html#a519777f5783981d534e9e53b99712069">run</a>(taskflows[pf.pipe()]).wait();</div>
<div class="line">    }},</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// third pipe calls taskflow3</span></div>
<div class="line">    <a class="code hl_class" href="classtf_1_1Pipe.html">tf::Pipe</a>{<a class="code hl_enumvalue" href="namespacetf.html#abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0">tf::PipeType::SERIAL</a>, [&amp;](<a class="code hl_class" href="classtf_1_1Pipeflow.html">tf::Pipeflow</a>&amp; pf) {</div>
<div class="line">      executor.<a class="code hl_function" href="classtf_1_1Executor.html#a519777f5783981d534e9e53b99712069">run</a>(taskflows[pf.pipe()]).wait();</div>
<div class="line">    }}</div>
<div class="line">  );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// build the pipeline graph using composition</span></div>
<div class="line">  <a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> init = taskflow.emplace([](){ <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;ready\n&quot;</span>; })</div>
<div class="line">                          .name(<span class="stringliteral">&quot;starting pipeline&quot;</span>);</div>
<div class="line">  <a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> task = taskflow.<a class="code hl_function" href="classtf_1_1Task.html#ab38be520fe700cb4ca1f312308a95585">composed_of</a>(pl)</div>
<div class="line">                          .<a class="code hl_function" href="classtf_1_1Task.html#a08ada0425b490997b6ff7f310107e5e3">name</a>(<span class="stringliteral">&quot;pipeline&quot;</span>);</div>
<div class="line">  <a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> stop = taskflow.emplace([](){ <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;stopped\n&quot;</span>; })</div>
<div class="line">                          .name(<span class="stringliteral">&quot;pipeline stopped&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// create task dependency</span></div>
<div class="line">  init.<a class="code hl_function" href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(task);</div>
<div class="line">  task.<a class="code hl_function" href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(stop);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// dump the pipeline graph structure (with composition)</span></div>
<div class="line">  taskflow.<a class="code hl_function" href="classtf_1_1Task.html#a3318a49ff9d0a01cd1e8ee675251e3b7">dump</a>(<a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// run the pipeline</span></div>
<div class="line">  executor.<a class="code hl_function" href="classtf_1_1Executor.html#a519777f5783981d534e9e53b99712069">run</a>(taskflow).wait();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aarray_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/container/array.html">std::array</a></div></div>
<div class="ttc" id="abasic_ostream_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a></div></div>
<div class="ttc" id="aclasstf_1_1Executor_html"><div class="ttname"><a href="classtf_1_1Executor.html">tf::Executor</a></div><div class="ttdoc">class to create an executor for running a taskflow graph</div><div class="ttdef"><b>Definition</b> executor.hpp:50</div></div>
<div class="ttc" id="aclasstf_1_1Executor_html_a519777f5783981d534e9e53b99712069"><div class="ttname"><a href="classtf_1_1Executor.html#a519777f5783981d534e9e53b99712069">tf::Executor::run</a></div><div class="ttdeci">tf::Future&lt; void &gt; run(Taskflow &amp;taskflow)</div><div class="ttdoc">runs a taskflow once</div><div class="ttdef"><b>Definition</b> executor.hpp:1573</div></div>
<div class="ttc" id="aclasstf_1_1Pipe_html"><div class="ttname"><a href="classtf_1_1Pipe.html">tf::Pipe</a></div><div class="ttdoc">class to create a pipe object for a pipeline stage</div><div class="ttdef"><b>Definition</b> pipeline.hpp:136</div></div>
<div class="ttc" id="aclasstf_1_1Pipeflow_html"><div class="ttname"><a href="classtf_1_1Pipeflow.html">tf::Pipeflow</a></div><div class="ttdoc">class to create a pipeflow object used by the pipe callable</div><div class="ttdef"><b>Definition</b> pipeline.hpp:42</div></div>
<div class="ttc" id="aclasstf_1_1Pipeline_html"><div class="ttname"><a href="classtf_1_1Pipeline.html">tf::Pipeline</a></div><div class="ttdoc">class to create a pipeline scheduling framework</div><div class="ttdef"><b>Definition</b> pipeline.hpp:312</div></div>
<div class="ttc" id="aclasstf_1_1Task_html"><div class="ttname"><a href="classtf_1_1Task.html">tf::Task</a></div><div class="ttdoc">class to create a task handle over a node in a taskflow graph</div><div class="ttdef"><b>Definition</b> task.hpp:187</div></div>
<div class="ttc" id="aclasstf_1_1Task_html_a08ada0425b490997b6ff7f310107e5e3"><div class="ttname"><a href="classtf_1_1Task.html#a08ada0425b490997b6ff7f310107e5e3">tf::Task::name</a></div><div class="ttdeci">const std::string &amp; name() const</div><div class="ttdoc">queries the name of the task</div><div class="ttdef"><b>Definition</b> task.hpp:499</div></div>
<div class="ttc" id="aclasstf_1_1Task_html_a3318a49ff9d0a01cd1e8ee675251e3b7"><div class="ttname"><a href="classtf_1_1Task.html#a3318a49ff9d0a01cd1e8ee675251e3b7">tf::Task::dump</a></div><div class="ttdeci">void dump(std::ostream &amp;ostream) const</div><div class="ttdoc">dumps the task through an output stream</div><div class="ttdef"><b>Definition</b> task.hpp:573</div></div>
<div class="ttc" id="aclasstf_1_1Task_html_a8c78c453295a553c1c016e4062da8588"><div class="ttname"><a href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">tf::Task::precede</a></div><div class="ttdeci">Task &amp; precede(Ts &amp;&amp;... tasks)</div><div class="ttdoc">adds precedence links from this to other tasks</div><div class="ttdef"><b>Definition</b> task.hpp:420</div></div>
<div class="ttc" id="aclasstf_1_1Task_html_ab38be520fe700cb4ca1f312308a95585"><div class="ttname"><a href="classtf_1_1Task.html#ab38be520fe700cb4ca1f312308a95585">tf::Task::composed_of</a></div><div class="ttdeci">Task &amp; composed_of(T &amp;object)</div><div class="ttdoc">creates a module task from a taskflow</div><div class="ttdef"><b>Definition</b> task.hpp:436</div></div>
<div class="ttc" id="aclasstf_1_1Taskflow_html"><div class="ttname"><a href="classtf_1_1Taskflow.html">tf::Taskflow</a></div><div class="ttdoc">class to create a taskflow object</div><div class="ttdef"><b>Definition</b> core/taskflow.hpp:73</div></div>
<div class="ttc" id="afprintf_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">std::printf</a></div><div class="ttdeci">T printf(T... args)</div></div>
<div class="ttc" id="anamespacetf_html"><div class="ttname"><a href="namespacetf.html">tf</a></div><div class="ttdoc">taskflow namespace</div><div class="ttdef"><b>Definition</b> small_vector.hpp:27</div></div>
<div class="ttc" id="anamespacetf_html_abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0"><div class="ttname"><a href="namespacetf.html#abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0">tf::PipeType::SERIAL</a></div><div class="ttdeci">@ SERIAL</div><div class="ttdoc">serial type</div></div>
<div class="ttc" id="apipeline_8hpp_html"><div class="ttname"><a href="pipeline_8hpp.html">pipeline.hpp</a></div><div class="ttdoc">pipeline include file</div></div>
<div class="ttc" id="ataskflow_8hpp_html"><div class="ttname"><a href="taskflow_8hpp.html">taskflow.hpp</a></div><div class="ttdoc">main taskflow include file</div></div>
</div><!-- fragment --><h2><a class="anchor" id="TaskflowPipelineDefineTaskflows"></a>
Define Taskflows</h2>
<p>First, we define three taskflows for the three pipes in the pipeline:</p>
<div class="fragment"><div class="line"><span class="comment">// taskflow on the first pipe</span></div>
<div class="line"><span class="keywordtype">void</span> make_taskflow1(<a class="code hl_class" href="classtf_1_1Taskflow.html">tf::Taskflow</a>&amp; <a class="code hl_namespace" href="namespacetf.html">tf</a>) {</div>
<div class="line">  <span class="keyword">auto</span> [A1, B1, C1, D1] = <a class="code hl_namespace" href="namespacetf.html">tf</a>.emplace(</div>
<div class="line">    [](){ printf(<span class="stringliteral">&quot;A1\n&quot;</span>); },</div>
<div class="line">    [](){ printf(<span class="stringliteral">&quot;B1\n&quot;</span>); },</div>
<div class="line">    [](){ printf(<span class="stringliteral">&quot;C1\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;D1\n&quot;</span>); }</div>
<div class="line">  );</div>
<div class="line">  A1.precede(B1, C1);</div>
<div class="line">  D1.succeed(B1, C1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// taskflow on the second pipe</span></div>
<div class="line"><span class="keywordtype">void</span> make_taskflow2(<a class="code hl_class" href="classtf_1_1Taskflow.html">tf::Taskflow</a>&amp; <a class="code hl_namespace" href="namespacetf.html">tf</a>) {</div>
<div class="line">  <span class="keyword">auto</span> [A2, B2, C2, D2] = <a class="code hl_namespace" href="namespacetf.html">tf</a>.emplace(</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;A2\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;B2\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;C2\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;D2\n&quot;</span>); }</div>
<div class="line">  );</div>
<div class="line">  <a class="code hl_namespace" href="namespacetf.html">tf</a>.linearize({A2, B2, C2, D2});</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// taskflow on the third pipe</span></div>
<div class="line"><span class="keywordtype">void</span> make_taskflow3(<a class="code hl_class" href="classtf_1_1Taskflow.html">tf::Taskflow</a>&amp; <a class="code hl_namespace" href="namespacetf.html">tf</a>) {</div>
<div class="line">  <span class="keyword">auto</span> [A3, B3, C3, D3] = <a class="code hl_namespace" href="namespacetf.html">tf</a>.emplace(</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;A3\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;B3\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;C3\n&quot;</span>); },</div>
<div class="line">    [](){ <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/io/c/fprintf.html">printf</a>(<span class="stringliteral">&quot;D3\n&quot;</span>); }</div>
<div class="line">  );</div>
<div class="line">  A3.precede(B3, C3, D3);</div>
<div class="line">}</div>
</div><!-- fragment --><p>As each taskflow corresponds to a pipe in the pipeline, we create a linear array to store the three taskflows:</p>
<div class="fragment"><div class="line"><a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/container/array.html">std::array&lt;tf::Taskflow, num_pipes&gt;</a> taskflows;</div>
<div class="line">make_taskflow1(taskflows[0]);</div>
<div class="line">make_taskflow2(taskflows[1]);</div>
<div class="line">make_taskflow3(taskflows[2]);</div>
</div><!-- fragment --><p>Since the three taskflows are linearly dependent, at most one taskflow will run at a pipe. We can store the three taskflows in a linear array of dimension equal to the number of pipes. If there is a parallel pipe, we need to use two-dimensional array, as multiple taskflows at a stage can run simultaneously across parallel lines.</p>
<h2><a class="anchor" id="TaskflowPipelineDefineThePipes"></a>
Define the Pipes</h2>
<p>The pipe definition is straightforward. Each pipe runs the corresponding taskflow, which can be indexed at <code>taskflows</code> with the pipe's identifier, <a class="el" href="classtf_1_1Pipeflow.html#a4914c1f381a3016e98285b019cf60d6d" title="queries the pipe identifier of the present token">tf::Pipeflow::pipe()</a>. The first pipe will cease the pipeline scheduling when it has processed five scheduling tokens:</p>
<div class="fragment"><div class="line"><span class="comment">// first pipe runs taskflow1</span></div>
<div class="line"><a class="code hl_class" href="classtf_1_1Pipe.html">tf::Pipe</a>{<a class="code hl_enumvalue" href="namespacetf.html#abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0">tf::PipeType::SERIAL</a>, [&amp;](<a class="code hl_class" href="classtf_1_1Pipeflow.html">tf::Pipeflow</a>&amp; pf) {</div>
<div class="line">  <span class="keywordflow">if</span>(pf.token() == 5) {</div>
<div class="line">    pf.stop();</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  printf(<span class="stringliteral">&quot;begin token %zu\n&quot;</span>, pf.token());</div>
<div class="line">  executor.<a class="code hl_function" href="classtf_1_1Executor.html#a519777f5783981d534e9e53b99712069">run</a>(taskflows[pf.pipe()]).wait();</div>
<div class="line">}},</div>
<div class="line"> </div>
<div class="line"><span class="comment">// second pipe runs taskflow2</span></div>
<div class="line"><a class="code hl_class" href="classtf_1_1Pipe.html">tf::Pipe</a>{<a class="code hl_enumvalue" href="namespacetf.html#abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0">tf::PipeType::SERIAL</a>, [&amp;](<a class="code hl_class" href="classtf_1_1Pipeflow.html">tf::Pipeflow</a>&amp; pf) {</div>
<div class="line">  executor.<a class="code hl_function" href="classtf_1_1Executor.html#a519777f5783981d534e9e53b99712069">run</a>(taskflows[pf.pipe()]).wait();</div>
<div class="line">}},</div>
<div class="line"> </div>
<div class="line"><span class="comment">// third pipe calls taskflow3</span></div>
<div class="line"><a class="code hl_class" href="classtf_1_1Pipe.html">tf::Pipe</a>{<a class="code hl_enumvalue" href="namespacetf.html#abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0">tf::PipeType::SERIAL</a>, [&amp;](<a class="code hl_class" href="classtf_1_1Pipeflow.html">tf::Pipeflow</a>&amp; pf) {</div>
<div class="line">  executor.<a class="code hl_function" href="classtf_1_1Executor.html#a519777f5783981d534e9e53b99712069">run</a>(taskflows[pf.pipe()]).wait();</div>
<div class="line">}}</div>
</div><!-- fragment --><h2><a class="anchor" id="TaskflowPipelineDefineTheTaskGraph"></a>
Define the Task Graph</h2>
<p>To build up the taskflow for the pipeline, we create a module task with the defined pipeline structure and connect it with two tasks that output helper messages before and after the pipeline:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> init = taskflow.emplace([](){ <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;ready\n&quot;</span>; })</div>
<div class="line">                        .name(<span class="stringliteral">&quot;starting pipeline&quot;</span>);</div>
<div class="line"><a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> task = taskflow.<a class="code hl_function" href="classtf_1_1Task.html#ab38be520fe700cb4ca1f312308a95585">composed_of</a>(pl)</div>
<div class="line">                        .<a class="code hl_function" href="classtf_1_1Task.html#a08ada0425b490997b6ff7f310107e5e3">name</a>(<span class="stringliteral">&quot;pipeline&quot;</span>);</div>
<div class="line"><a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> stop = taskflow.emplace([](){ <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;stopped\n&quot;</span>; })</div>
<div class="line">                        .name(<span class="stringliteral">&quot;pipeline stopped&quot;</span>);</div>
<div class="line">init.<a class="code hl_function" href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(task);</div>
<div class="line">task.<a class="code hl_function" href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(stop);</div>
</div><!-- fragment --><div class="dotgraph">
<img src="dot_taskflow_processing_pipeline_3.png" alt="dot_taskflow_processing_pipeline_3.png" border="0" usemap="#dot_taskflow_processing_pipeline_3.map"/>
</div>
<h2><a class="anchor" id="TaskflowPipelineSubmitTheTaskGraph"></a>
Submit the Task Graph</h2>
<p>Finally, we submit the taskflow to the execution and run it once:</p>
<div class="fragment"><div class="line">executor.<a class="code hl_function" href="classtf_1_1Executor.html#a519777f5783981d534e9e53b99712069">run</a>(taskflow).wait();</div>
</div><!-- fragment --><p>One possible output is shown below:</p>
<div class="fragment"><div class="line">ready</div>
<div class="line">begin token 0</div>
<div class="line">A1</div>
<div class="line">C1</div>
<div class="line">B1</div>
<div class="line">D1</div>
<div class="line">begin token 1</div>
<div class="line">A2</div>
<div class="line">B2</div>
<div class="line">A1</div>
<div class="line">C1</div>
<div class="line">B1</div>
<div class="line">D1</div>
<div class="line">C2</div>
<div class="line">D2</div>
<div class="line">A3</div>
<div class="line">D3</div>
<div class="line">C3</div>
<div class="line">B3</div>
<div class="line">begin token 2</div>
<div class="line">A2</div>
<div class="line">B2</div>
<div class="line">C2</div>
<div class="line">D2</div>
<div class="line">A1</div>
<div class="line">C1</div>
<div class="line">B1</div>
<div class="line">D1</div>
<div class="line">A3</div>
<div class="line">D3</div>
<div class="line">C3</div>
<div class="line">B3</div>
<div class="line">A2</div>
<div class="line">B2</div>
<div class="line">C2</div>
<div class="line">D2</div>
<div class="line">begin token 3</div>
<div class="line">A3</div>
<div class="line">D3</div>
<div class="line">C3</div>
<div class="line">B3</div>
<div class="line">A1</div>
<div class="line">C1</div>
<div class="line">B1</div>
<div class="line">D1</div>
<div class="line">begin token 4</div>
<div class="line">A2</div>
<div class="line">A1</div>
<div class="line">C1</div>
<div class="line">B1</div>
<div class="line">D1</div>
<div class="line">B2</div>
<div class="line">C2</div>
<div class="line">D2</div>
<div class="line">A3</div>
<div class="line">D3</div>
<div class="line">C3</div>
<div class="line">B3</div>
<div class="line">A2</div>
<div class="line">B2</div>
<div class="line">C2</div>
<div class="line">D2</div>
<div class="line">A3</div>
<div class="line">D3</div>
<div class="line">C3</div>
<div class="line">B3</div>
<div class="line">stopped</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Examples.html">Learning from Examples</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
