<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Taskflow Handbook</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/x-icon" href="favicon.ico" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="taskflow_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="https://taskflow.github.io/">Taskflow</a>
   &#160;<span id="projectnumber">3.2.0-Master-Branch</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('CUDASTDScan.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Parallel Scan</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#CUDASTDParallelScanIncludeTheHeader">Include the Header</a></li>
<li class="level1"><a href="#CUDASTDScanItems">Scan a Range of Items</a></li>
<li class="level1"><a href="#CUDASTDScanTransformedItems">Scan a Range of Transformed Items</a></li>
</ul>
</div>
<div class="textblock"><p>Taskflow provides standard template methods for scanning a range of items on a CUDA GPU.</p>
<h1><a class="anchor" id="CUDASTDParallelScanIncludeTheHeader"></a>
Include the Header</h1>
<p>You need to include the header file, <code>taskflow/cuda/algorithm/scan.hpp</code>, for using the parallel-scan algorithm.</p>
<h1><a class="anchor" id="CUDASTDScanItems"></a>
Scan a Range of Items</h1>
<p><a class="el" href="namespacetf.html#a2e1b44c84a09e0a8495a611cb9a7ea40" title="performs asynchronous inclusive scan over a range of items">tf::cuda_inclusive_scan</a> computes an inclusive prefix sum operation using the given binary operator over a range of elements specified by <code>[first, last)</code>. The term &quot;inclusive&quot; means that the i-th input element is included in the i-th sum. The following code computes the inclusive prefix sum over an input array and stores the result in an output array.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> N = 1000000;</div>
<div class="line"><span class="keywordtype">int</span>* input  = tf::cuda_malloc_shared&lt;int&gt;(N);  <span class="comment">// input  vector</span></div>
<div class="line"><span class="keywordtype">int</span>* output = tf::cuda_malloc_shared&lt;int&gt;(N);  <span class="comment">// output vector</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// initializes the data</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;N; input[i++] = rand()); </div>
<div class="line"> </div>
<div class="line"><span class="comment">// queries the required buffer size to scan N elements using the given policy</span></div>
<div class="line"><a class="code hl_class" href="classtf_1_1cudaExecutionPolicy.html">tf::cudaDefaultExecutionPolicy</a> policy;</div>
<div class="line"><span class="keyword">auto</span> bytes  = tf::cuda_scan_buffer_size&lt;tf::cudaDefaultExecutionPolicy, int&gt;(N);</div>
<div class="line"><span class="keyword">auto</span> buffer = tf::cuda_malloc_device&lt;std::byte&gt;(bytes);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// computes inclusive scan over input and stores the result in output</span></div>
<div class="line"><a class="code hl_function" href="namespacetf.html#a2e1b44c84a09e0a8495a611cb9a7ea40">tf::cuda_inclusive_scan</a>(policy, </div>
<div class="line">  input, input + N, output, [] __device__ (<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b) {<span class="keywordflow">return</span> a + b;}, buffer</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// synchronizes and verifies the result</span></div>
<div class="line">policy.synchronize();</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=1; i&lt;N; i++) {</div>
<div class="line">  assert(output[i] == output[i-1] + input[i]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// delete the buffer</span></div>
<div class="line"><a class="code hl_function" href="namespacetf.html#ac7a8fe7456b888d6072ba94783c5003c">tf::cuda_free</a>(buffer);</div>
<div class="ttc" id="aclasstf_1_1cudaExecutionPolicy_html"><div class="ttname"><a href="classtf_1_1cudaExecutionPolicy.html">tf::cudaExecutionPolicy</a></div><div class="ttdoc">class to define execution policy for CUDA standard algorithms</div><div class="ttdef"><b>Definition</b> cuda_execution_policy.hpp:29</div></div>
<div class="ttc" id="anamespacetf_html_a2e1b44c84a09e0a8495a611cb9a7ea40"><div class="ttname"><a href="namespacetf.html#a2e1b44c84a09e0a8495a611cb9a7ea40">tf::cuda_inclusive_scan</a></div><div class="ttdeci">void cuda_inclusive_scan(P &amp;&amp;p, I first, I last, O output, C op, void *buf)</div><div class="ttdoc">performs asynchronous inclusive scan over a range of items</div><div class="ttdef"><b>Definition</b> scan.hpp:394</div></div>
<div class="ttc" id="anamespacetf_html_ac7a8fe7456b888d6072ba94783c5003c"><div class="ttname"><a href="namespacetf.html#ac7a8fe7456b888d6072ba94783c5003c">tf::cuda_free</a></div><div class="ttdeci">void cuda_free(T *ptr, int d)</div><div class="ttdoc">frees memory on the GPU device</div><div class="ttdef"><b>Definition</b> cuda_memory.hpp:101</div></div>
</div><!-- fragment --><p>The scan algorithm runs <em>asynchronously</em> through the stream specified in the execution policy. You need to synchronize the stream to obtain correct results. Since the GPU scan algorithm may require extra buffer to store the temporary results, you must provide a buffer of size at least bytes returned from <a class="el" href="namespacetf.html#afd7e7a0886352201cced5c55205f3229" title="queries the buffer size in bytes needed to call scan kernels">tf::cuda_scan_buffer_size</a>.</p>
<dl class="section attention"><dt>Attention</dt><dd>You must keep the buffer alive before the scan call completes.</dd></dl>
<p>On the other hand, <a class="el" href="namespacetf.html#aeb391c40120844318fd715b8c3a716bb" title="performs asynchronous exclusive scan over a range of items">tf::cuda_exclusive_scan</a> computes an exclusive prefix sum operation. The term &quot;exclusive&quot; means that the i-th input element is <em>NOT</em> included in the i-th sum.</p>
<div class="fragment"><div class="line"><span class="comment">// computes exclusive scan over input and stores the result in output</span></div>
<div class="line"><a class="code hl_function" href="namespacetf.html#aeb391c40120844318fd715b8c3a716bb">tf::cuda_exclusive_scan</a>(policy, </div>
<div class="line">  input, input + N, output, [] __device__ (<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b) {<span class="keywordflow">return</span> a + b;}, buffer</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// synchronizes the execution and verifies the result</span></div>
<div class="line">policy.synchronize();</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=1; i&lt;N; i++) {</div>
<div class="line">  assert(output[i] == output[i-1] + input[i-1]);</div>
<div class="line">}</div>
<div class="ttc" id="anamespacetf_html_aeb391c40120844318fd715b8c3a716bb"><div class="ttname"><a href="namespacetf.html#aeb391c40120844318fd715b8c3a716bb">tf::cuda_exclusive_scan</a></div><div class="ttdeci">void cuda_exclusive_scan(P &amp;&amp;p, I first, I last, O output, C op, void *buf)</div><div class="ttdoc">performs asynchronous exclusive scan over a range of items</div><div class="ttdef"><b>Definition</b> scan.hpp:526</div></div>
</div><!-- fragment --><h1><a class="anchor" id="CUDASTDScanTransformedItems"></a>
Scan a Range of Transformed Items</h1>
<p><a class="el" href="namespacetf.html#afa4aa760ddb6efbda1b9bab505ad5baf" title="performs asynchronous inclusive scan over a range of transformed items">tf::cuda_transform_inclusive_scan</a> transforms each item in the range <code>[first, last)</code> and computes an inclusive prefix sum over these transformed items. The following code multiplies each item by 10 and then compute the inclusive prefix sum over 1000000 transformed items.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> N = 1000000;</div>
<div class="line"><span class="keywordtype">int</span>* input  = tf::cuda_malloc_shared&lt;int&gt;(N);  <span class="comment">// input  vector</span></div>
<div class="line"><span class="keywordtype">int</span>* output = tf::cuda_malloc_shared&lt;int&gt;(N);  <span class="comment">// output vector</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// initializes the data</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;N; input[i++] = rand()); </div>
<div class="line"> </div>
<div class="line"><span class="comment">// queries the required buffer size to scan N elements using the given policy</span></div>
<div class="line"><a class="code hl_class" href="classtf_1_1cudaExecutionPolicy.html">tf::cudaDefaultExecutionPolicy</a> policy;</div>
<div class="line"><span class="keyword">auto</span> bytes  = tf::cuda_scan_buffer_size&lt;tf::cudaDefaultExecutionPolicy, int&gt;(N);</div>
<div class="line"><span class="keyword">auto</span> buffer = tf::cuda_malloc_device&lt;std::byte&gt;(bytes);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// computes inclusive scan over transformed input and stores the result in output</span></div>
<div class="line"><a class="code hl_function" href="namespacetf.html#afa4aa760ddb6efbda1b9bab505ad5baf">tf::cuda_transform_inclusive_scan</a>(policy, </div>
<div class="line">  input, input + N, output, </div>
<div class="line">  [] __device__ (<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b) { <span class="keywordflow">return</span> a + b; },  <span class="comment">// binary scan operator</span></div>
<div class="line">  [] __device__ (<span class="keywordtype">int</span> a) { <span class="keywordflow">return</span> a*10; },          <span class="comment">// unary transform operator</span></div>
<div class="line">  buffer</div>
<div class="line">);</div>
<div class="line">policy.synchronize();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// verifies the result</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=1; i&lt;N; i++) {</div>
<div class="line">  assert(output[i] == output[i-1] + input[i] * 10);</div>
<div class="line">}</div>
<div class="ttc" id="anamespacetf_html_afa4aa760ddb6efbda1b9bab505ad5baf"><div class="ttname"><a href="namespacetf.html#afa4aa760ddb6efbda1b9bab505ad5baf">tf::cuda_transform_inclusive_scan</a></div><div class="ttdeci">void cuda_transform_inclusive_scan(P &amp;&amp;p, I first, I last, O output, C bop, U uop, void *buf)</div><div class="ttdoc">performs asynchronous inclusive scan over a range of transformed items</div><div class="ttdef"><b>Definition</b> scan.hpp:461</div></div>
</div><!-- fragment --><p>Similarly, <a class="el" href="namespacetf.html#a2e739895c1c73538967af060ca714366" title="performs asynchronous exclusive scan over a range of items">tf::cuda_transform_exclusive_scan</a> performs an exclusive prefix sum over a range of transformed items. The following code computes the exclusive prefix sum over 1000000 transformed items each multipled by 10.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> N = 1000000;</div>
<div class="line"><span class="keywordtype">int</span>* input  = tf::cuda_malloc_shared&lt;int&gt;(N);  <span class="comment">// input  vector</span></div>
<div class="line"><span class="keywordtype">int</span>* output = tf::cuda_malloc_shared&lt;int&gt;(N);  <span class="comment">// output vector</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// initializes the data</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;N; input[i++] = rand()); </div>
<div class="line"> </div>
<div class="line"><span class="comment">// queries the required buffer size to scan N elements using the given policy</span></div>
<div class="line"><a class="code hl_class" href="classtf_1_1cudaExecutionPolicy.html">tf::cudaDefaultExecutionPolicy</a> policy;</div>
<div class="line"><span class="keyword">auto</span> bytes  = tf::cuda_scan_buffer_size&lt;tf::cudaDefaultExecutionPolicy, int&gt;(N);</div>
<div class="line"><span class="keyword">auto</span> buffer = tf::cuda_malloc_device&lt;std::byte&gt;(bytes);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// computes exclusive scan over transformed input and stores the result in output</span></div>
<div class="line"><a class="code hl_function" href="namespacetf.html#a2e739895c1c73538967af060ca714366">tf::cuda_transform_exclusive_scan</a>(policy, </div>
<div class="line">  input, input + N, output, </div>
<div class="line">  [] __device__ (<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b) { <span class="keywordflow">return</span> a + b; },  <span class="comment">// binary scan operator</span></div>
<div class="line">  [] __device__ (<span class="keywordtype">int</span> a) { <span class="keywordflow">return</span> a*10; },          <span class="comment">// unary transform operator</span></div>
<div class="line">  buffer</div>
<div class="line">);</div>
<div class="line">policy.synchronize();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// verifies the result</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=1; i&lt;N; i++) {</div>
<div class="line">  assert(output[i] == output[i-1] + input[i-1] * 10);</div>
<div class="line">}</div>
<div class="ttc" id="anamespacetf_html_a2e739895c1c73538967af060ca714366"><div class="ttname"><a href="namespacetf.html#a2e739895c1c73538967af060ca714366">tf::cuda_transform_exclusive_scan</a></div><div class="ttdeci">void cuda_transform_exclusive_scan(P &amp;&amp;p, I first, I last, O output, C bop, U uop, void *buf)</div><div class="ttdoc">performs asynchronous exclusive scan over a range of items</div><div class="ttdef"><b>Definition</b> scan.hpp:593</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="cudaStandardAlgorithms.html">CUDA Standard Algorithms</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
