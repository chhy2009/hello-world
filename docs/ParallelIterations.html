<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Taskflow Handbook</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/x-icon" href="favicon.ico" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="taskflow_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="https://taskflow.github.io/">Taskflow</a>
   &#160;<span id="projectnumber">3.2.0-Master-Branch</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('ParallelIterations.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Parallel Iterations</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#A1IndexBasedParallelFor">Create an Index-based Parallel-Iteration Task</a></li>
<li class="level1"><a href="#A1IteratorBasedParallelFor">Create an Iterator-based Parallel-Iteration Task</a></li>
</ul>
</div>
<div class="textblock"><p>Taskflow provides template functions for constructing tasks to perform parallel iterations over ranges of items.</p>
<h1><a class="anchor" id="A1IndexBasedParallelFor"></a>
Create an Index-based Parallel-Iteration Task</h1>
<p>Index-based parallel-for performs parallel iterations over a range <code>[first, last)</code> with the given <code>step</code> size. The task created by <a class="el" href="classtf_1_1FlowBuilder.html#a38ffe176bc3ae1827b9964322e3769d4" title="constructs a parallel-transform task">tf::Taskflow::for_each_index(B first, E last, S step, C callable)</a> represents parallel execution of the following loop:</p>
<div class="fragment"><div class="line"><span class="comment">// positive step</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keyword">auto</span> i=first; i&lt;last; i+=step) {</div>
<div class="line">  callable(i);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// negative step</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keyword">auto</span> i=first; i&gt;last; i+=step) {</div>
<div class="line">  callable(i);</div>
<div class="line">}</div>
</div><!-- fragment --><p>We support only integer-based range. The range can go positive or negative direction.</p>
<div class="fragment"><div class="line">taskflow.for_each_index(0, 100,  2, [](<span class="keywordtype">int</span> i) { });  <span class="comment">// 50 loops with a + step</span></div>
<div class="line">taskflow.for_each_index(100, 0, -2, [](<span class="keywordtype">int</span> i) { });  <span class="comment">// 50 loops with a - step</span></div>
</div><!-- fragment --><p>Notice that either positive or negative direction is defined in terms of the range, <code>[first, last)</code>, where <code>end</code> is excluded. In the positive case, the 50 items are 0, 2, 4, 6, 8, ..., 96, 98. In the negative case, the 50 items are 100, 98, 96, 04, ... 4, 2. An example of the Taskflow graph for the positive case under 12 workers is depicted below:</p>
<div class="dotgraph">
<img src="dot_parallel_for_1.png" alt="dot_parallel_for_1.png" border="0" usemap="#dot_parallel_for_1.map"/>
</div>
<p>The index types, <code>B</code>, <code>E</code>, and <code>S</code>, are templates to preserve the variable types and their underlying types must be of the same <em>integral</em> type (e.g., <code>int</code>, <code>size_t</code>, <code>unsigned</code>). By default, <a class="el" href="classtf_1_1FlowBuilder.html#a38ffe176bc3ae1827b9964322e3769d4" title="constructs a parallel-transform task">tf::Taskflow::for_each_index</a> creates a task that spawns a subflow (see <a class="el" href="DynamicTasking.html">Dynamic Tasking</a>) to run iterations in parallel. The subflow closure captures all input arguments through perfect forwarding to form a stateful closure such that any changes on the arguments will be visible to the execution context of the subflow. For example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span>* vec;</div>
<div class="line"><span class="keywordtype">int</span> first, last;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> init = taskflow.emplace([&amp;](){</div>
<div class="line">  first = 0;</div>
<div class="line">  last  = 1000;</div>
<div class="line">  vec = <span class="keyword">new</span> <span class="keywordtype">int</span>[1000];  </div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> pf = taskflow.for_each_index(<a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/utility/functional/ref.html">std::ref</a>(first), <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/utility/functional/ref.html">std::ref</a>(last), 1, </div>
<div class="line">  [&amp;] (<span class="keywordtype">int</span> i) {</div>
<div class="line">    <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;parallel iteration on index &quot;</span> &lt;&lt; vec[i] &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// wrong! must use std::ref, or first and last are captured by copy</span></div>
<div class="line"><span class="comment">// auto pf = taskflow.for_each_index(first, last, 1, [&amp;](int i) {</span></div>
<div class="line"><span class="comment">//   std::cout &lt;&lt; &quot;parallel iteration on index &quot; &lt;&lt; vec[i] &lt;&lt; &#39;\n&#39;;</span></div>
<div class="line"><span class="comment">// });</span></div>
<div class="line"> </div>
<div class="line">init.precede(pf);</div>
<div class="ttc" id="abasic_ostream_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a></div></div>
<div class="ttc" id="aref_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/utility/functional/ref.html">std::ref</a></div><div class="ttdeci">T ref(T... args)</div></div>
</div><!-- fragment --><p>When <code>init</code> finishes, the parallel-for task <code>pf</code> will see <code>first</code> as 0 and <code>last</code> as 1000 and performs parallel iterations over the 1000 items. This property is especially important for task graph parallelism, because users can define end-to-end parallelism through stateful closures that marshal parameter exchange between dependent tasks.</p>
<h1><a class="anchor" id="A1IteratorBasedParallelFor"></a>
Create an Iterator-based Parallel-Iteration Task</h1>
<p>Iterator-based parallel-for performs parallel iterations over a range specified by two <a href="https://en.cppreference.com/w/cpp/iterator/iterator">STL-styled iterators</a>, <code>first</code> and <code>last</code>. The task created by <a class="el" href="classtf_1_1FlowBuilder.html#ab405d7b10040530d8b04c11767b4960d" title="constructs a STL-styled parallel-for task">tf::Taskflow::for_each(B first, E last, C callable)</a> represents a parallel execution of the following loop:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span>(<span class="keyword">auto</span> i=first; i&lt;last; i++) {</div>
<div class="line">  callable(*i);</div>
<div class="line">}</div>
</div><!-- fragment --><p>By default, <a class="el" href="classtf_1_1FlowBuilder.html#ab405d7b10040530d8b04c11767b4960d" title="constructs a STL-styled parallel-for task">tf::Taskflow::for_each(B first, E last, C callable)</a> creates a task that spawns a subflow (see <a class="el" href="DynamicTasking.html">Dynamic Tasking</a>) that applies the callable to the object obtained by dereferencing every iterator in the range <code>[first, last)</code>. It is user's responsibility for ensuring the range is valid within the execution of the parallel-for task. Iterators must have the post-increment operator ++ defined. This version of parallel-for applies to all iterable STL containers.</p>
<div class="fragment"><div class="line"><a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a> vec = {1, 2, 3, 4, 5};</div>
<div class="line">taskflow.for_each(vec.begin(), vec.end(), [](<span class="keywordtype">int</span> i){ </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;parallel for on item &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&#39;\n&#39;</span>;  </div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/container/list.html">std::list&lt;std::string&gt;</a> list = {<span class="stringliteral">&quot;hi&quot;</span>, <span class="stringliteral">&quot;from&quot;</span>, <span class="stringliteral">&quot;t&quot;</span>, <span class="stringliteral">&quot;a&quot;</span>, <span class="stringliteral">&quot;s&quot;</span>, <span class="stringliteral">&quot;k&quot;</span>, <span class="stringliteral">&quot;f&quot;</span>, <span class="stringliteral">&quot;low&quot;</span>};</div>
<div class="line">taskflow.for_each(list.begin(), list.end(), [](<span class="keyword">const</span> <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a>&amp; str){ </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;parallel for on item &quot;</span> &lt;&lt; str &lt;&lt; <span class="stringliteral">&#39;\n&#39;</span>;  </div>
<div class="line">});</div>
<div class="ttc" id="abasic_string_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a></div></div>
<div class="ttc" id="alist_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/container/list.html">std::list</a></div></div>
<div class="ttc" id="avector_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector</a></div></div>
</div><!-- fragment --><p>Similar to index-based parallel-for, the iterator types are templates to enable users to leverage the property of stateful closure. For example:</p>
<div class="fragment"><div class="line"><a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a> vec;</div>
<div class="line"><a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;::iterator</a> first, last;;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> init = taskflow.emplace([&amp;](){</div>
<div class="line">  vec.resize(1000);</div>
<div class="line">  first = vec.begin();</div>
<div class="line">  last  = vec.end();</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> pf = taskflow.for_each(<a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/utility/functional/ref.html">std::ref</a>(first), <a class="code hl_functionRef" href="http://en.cppreference.com/w/cpp/utility/functional/ref.html">std::ref</a>(last), [&amp;](<span class="keywordtype">int</span> i) {</div>
<div class="line">  <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;parallel iteration on item &quot;</span> &lt;&lt; i &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><span class="comment">// wrong! must use std::ref, or first and last are captured by copy</span></div>
<div class="line"><span class="comment">// tf::Task pf = taskflow.for_each(first, last, [&amp;](int i) {</span></div>
<div class="line"><span class="comment">//   std::cout &lt;&lt; &quot;parallel iteration on item &quot; &lt;&lt; i &lt;&lt; &#39;\n&#39;;</span></div>
<div class="line"><span class="comment">// });</span></div>
<div class="line"> </div>
<div class="line">init.<a class="code hl_function" href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(pf);</div>
<div class="ttc" id="aclasstf_1_1Task_html"><div class="ttname"><a href="classtf_1_1Task.html">tf::Task</a></div><div class="ttdoc">class to create a task handle over a node in a taskflow graph</div><div class="ttdef"><b>Definition</b> task.hpp:187</div></div>
<div class="ttc" id="aclasstf_1_1Task_html_a8c78c453295a553c1c016e4062da8588"><div class="ttname"><a href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">tf::Task::precede</a></div><div class="ttdeci">Task &amp; precede(Ts &amp;&amp;... tasks)</div><div class="ttdoc">adds precedence links from this to other tasks</div><div class="ttdef"><b>Definition</b> task.hpp:420</div></div>
</div><!-- fragment --><p>When <code>init</code> finishes, the parallel-for task <code>pf</code> will see <code>first</code> pointing to the beginning of <code>vec</code> and <code>last</code> pointing to the end of <code>vec</code> and performs parallel iterations over the 1000 items. The two tasks form an end-to-end task graph where the parameters of parallel-for are computed on the fly. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Algorithms.html">Taskflow Algorithms</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
