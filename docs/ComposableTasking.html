<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Taskflow Handbook</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/x-icon" href="favicon.ico" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="taskflow_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="https://taskflow.github.io/">Taskflow</a>
   &#160;<span id="projectnumber">3.2.0-Master-Branch</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('ComposableTasking.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Composable Tasking</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#ComposeATaskflow">Compose a Taskflow</a></li>
<li class="level1"><a href="#CreateAModuleTask">Create a Module Task</a></li>
<li class="level1"><a href="#CreateACustomComposableGraph">Create a Custom Composable Graph</a></li>
</ul>
</div>
<div class="textblock"><p>Composition is a key to improve the programmability of a complex workflow. This chapter describes how to create a large parallel graph through composition of modular and reusable blocks that are easier to optimize.</p>
<h1><a class="anchor" id="ComposeATaskflow"></a>
Compose a Taskflow</h1>
<p>A powerful feature of <a class="el" href="classtf_1_1Taskflow.html" title="class to create a taskflow object">tf::Taskflow</a> is its <em>composable</em> interface. You can break down a large parallel workload into smaller pieces each designed to run a specific task dependency graph. This largely facilitates the <em>modularity</em> of writing a parallel task program.</p>
<div class="fragment"><div class="line"> 1: <span class="comment">// f1 has three independent tasks</span></div>
<div class="line"> 2: <a class="code hl_class" href="classtf_1_1Taskflow.html">tf::Taskflow</a> f1;</div>
<div class="line"> 3: f1.<a class="code hl_function" href="classtf_1_1Taskflow.html#ad5706e5819aa01a63c4aa2e3485546b9">name</a>(<span class="stringliteral">&quot;F1&quot;</span>);</div>
<div class="line"> 4: <a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> f1A = f1.<a class="code hl_function" href="classtf_1_1FlowBuilder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([&amp;](){ <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;F1 TaskA\n&quot;</span>; });</div>
<div class="line"> 5: <a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> f1B = f1.<a class="code hl_function" href="classtf_1_1FlowBuilder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([&amp;](){ <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;F1 TaskB\n&quot;</span>; });</div>
<div class="line"> 6: <a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> f1C = f1.<a class="code hl_function" href="classtf_1_1FlowBuilder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([&amp;](){ <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;F1 TaskC\n&quot;</span>; });</div>
<div class="line"> 7: </div>
<div class="line"> 8: f1A.<a class="code hl_function" href="classtf_1_1Task.html#a08ada0425b490997b6ff7f310107e5e3">name</a>(<span class="stringliteral">&quot;f1A&quot;</span>);</div>
<div class="line"> 9: f1B.<a class="code hl_function" href="classtf_1_1Task.html#a08ada0425b490997b6ff7f310107e5e3">name</a>(<span class="stringliteral">&quot;f1B&quot;</span>);</div>
<div class="line">10: f1C.<a class="code hl_function" href="classtf_1_1Task.html#a08ada0425b490997b6ff7f310107e5e3">name</a>(<span class="stringliteral">&quot;f1C&quot;</span>);</div>
<div class="line">11: f1A.<a class="code hl_function" href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(f1C);</div>
<div class="line">12: f1B.<a class="code hl_function" href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(f1C);</div>
<div class="line">13:</div>
<div class="line">14: <span class="comment">// f2A ---</span></div>
<div class="line">15: <span class="comment">//        |----&gt; f2C ----&gt; f1_module_task ----&gt; f2D</span></div>
<div class="line">16: <span class="comment">// f2B --- </span></div>
<div class="line">17: <a class="code hl_class" href="classtf_1_1Taskflow.html">tf::Taskflow</a> f2;</div>
<div class="line">18: f2.<a class="code hl_function" href="classtf_1_1Taskflow.html#ad5706e5819aa01a63c4aa2e3485546b9">name</a>(<span class="stringliteral">&quot;F2&quot;</span>);</div>
<div class="line">19: <a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> f2A = f2.<a class="code hl_function" href="classtf_1_1FlowBuilder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([&amp;](){ <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  F2 TaskA\n&quot;</span>; });</div>
<div class="line">20: <a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> f2B = f2.<a class="code hl_function" href="classtf_1_1FlowBuilder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([&amp;](){ <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  F2 TaskB\n&quot;</span>; });</div>
<div class="line">21: <a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> f2C = f2.<a class="code hl_function" href="classtf_1_1FlowBuilder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([&amp;](){ <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  F2 TaskC\n&quot;</span>; });</div>
<div class="line">22: <a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> f2D = f2.<a class="code hl_function" href="classtf_1_1FlowBuilder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([&amp;](){ <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;  F2 TaskD\n&quot;</span>; });</div>
<div class="line">23: </div>
<div class="line">24: f2A.<a class="code hl_function" href="classtf_1_1Task.html#a08ada0425b490997b6ff7f310107e5e3">name</a>(<span class="stringliteral">&quot;f2A&quot;</span>);</div>
<div class="line">25: f2B.<a class="code hl_function" href="classtf_1_1Task.html#a08ada0425b490997b6ff7f310107e5e3">name</a>(<span class="stringliteral">&quot;f2B&quot;</span>);</div>
<div class="line">26: f2C.<a class="code hl_function" href="classtf_1_1Task.html#a08ada0425b490997b6ff7f310107e5e3">name</a>(<span class="stringliteral">&quot;f2C&quot;</span>);</div>
<div class="line">27: f2D.<a class="code hl_function" href="classtf_1_1Task.html#a08ada0425b490997b6ff7f310107e5e3">name</a>(<span class="stringliteral">&quot;f2D&quot;</span>);</div>
<div class="line">28:</div>
<div class="line">29: f2A.<a class="code hl_function" href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(f2C);</div>
<div class="line">30: f2B.<a class="code hl_function" href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(f2C);</div>
<div class="line">31:</div>
<div class="line">32: <a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> f1_module_task = f2.<a class="code hl_function" href="classtf_1_1FlowBuilder.html#ac6f22228d4c2ea2e643c4b0d42c0e92a">composed_of</a>(f1).<a class="code hl_function" href="classtf_1_1Task.html#a08ada0425b490997b6ff7f310107e5e3">name</a>(<span class="stringliteral">&quot;module&quot;</span>);</div>
<div class="line">33: f2C.<a class="code hl_function" href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(f1_module_task);</div>
<div class="line">34: f1_module_task.<a class="code hl_function" href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(f2D);</div>
<div class="line">35:</div>
<div class="line">36: f2.<a class="code hl_function" href="classtf_1_1Taskflow.html#ac433018262e44b12c4cc9f0c4748d758">dump</a>(<a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a>);</div>
<div class="ttc" id="abasic_ostream_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a></div></div>
<div class="ttc" id="aclasstf_1_1FlowBuilder_html_a60d7a666cab71ecfa3010b2efb0d6b57"><div class="ttname"><a href="classtf_1_1FlowBuilder.html#a60d7a666cab71ecfa3010b2efb0d6b57">tf::FlowBuilder::emplace</a></div><div class="ttdeci">Task emplace(C &amp;&amp;callable)</div><div class="ttdoc">creates a static task</div><div class="ttdef"><b>Definition</b> flow_builder.hpp:742</div></div>
<div class="ttc" id="aclasstf_1_1FlowBuilder_html_ac6f22228d4c2ea2e643c4b0d42c0e92a"><div class="ttname"><a href="classtf_1_1FlowBuilder.html#ac6f22228d4c2ea2e643c4b0d42c0e92a">tf::FlowBuilder::composed_of</a></div><div class="ttdeci">Task composed_of(T &amp;object)</div><div class="ttdoc">creates a module task for the target object</div><div class="ttdef"><b>Definition</b> flow_builder.hpp:812</div></div>
<div class="ttc" id="aclasstf_1_1Task_html"><div class="ttname"><a href="classtf_1_1Task.html">tf::Task</a></div><div class="ttdoc">class to create a task handle over a node in a taskflow graph</div><div class="ttdef"><b>Definition</b> task.hpp:187</div></div>
<div class="ttc" id="aclasstf_1_1Task_html_a08ada0425b490997b6ff7f310107e5e3"><div class="ttname"><a href="classtf_1_1Task.html#a08ada0425b490997b6ff7f310107e5e3">tf::Task::name</a></div><div class="ttdeci">const std::string &amp; name() const</div><div class="ttdoc">queries the name of the task</div><div class="ttdef"><b>Definition</b> task.hpp:499</div></div>
<div class="ttc" id="aclasstf_1_1Task_html_a8c78c453295a553c1c016e4062da8588"><div class="ttname"><a href="classtf_1_1Task.html#a8c78c453295a553c1c016e4062da8588">tf::Task::precede</a></div><div class="ttdeci">Task &amp; precede(Ts &amp;&amp;... tasks)</div><div class="ttdoc">adds precedence links from this to other tasks</div><div class="ttdef"><b>Definition</b> task.hpp:420</div></div>
<div class="ttc" id="aclasstf_1_1Taskflow_html"><div class="ttname"><a href="classtf_1_1Taskflow.html">tf::Taskflow</a></div><div class="ttdoc">class to create a taskflow object</div><div class="ttdef"><b>Definition</b> core/taskflow.hpp:73</div></div>
<div class="ttc" id="aclasstf_1_1Taskflow_html_ac433018262e44b12c4cc9f0c4748d758"><div class="ttname"><a href="classtf_1_1Taskflow.html#ac433018262e44b12c4cc9f0c4748d758">tf::Taskflow::dump</a></div><div class="ttdeci">void dump(std::ostream &amp;ostream) const</div><div class="ttdoc">dumps the taskflow to a DOT format through a std::ostream target</div><div class="ttdef"><b>Definition</b> core/taskflow.hpp:363</div></div>
<div class="ttc" id="aclasstf_1_1Taskflow_html_ad5706e5819aa01a63c4aa2e3485546b9"><div class="ttname"><a href="classtf_1_1Taskflow.html#ad5706e5819aa01a63c4aa2e3485546b9">tf::Taskflow::name</a></div><div class="ttdeci">void name(const std::string &amp;)</div><div class="ttdoc">assigns a name to the taskflow</div><div class="ttdef"><b>Definition</b> core/taskflow.hpp:333</div></div>
</div><!-- fragment --><div class="dotgraph">
<img src="dot_composition_static_1.png" alt="dot_composition_static_1.png" border="0" usemap="#dot_composition_static_1.map"/>
</div>
<p>Debrief:</p>
<ul>
<li>Lines 1-12 create a taskflow of three tasks f1A, f1B, and f1C with f1A and f1B preceding f1C </li>
<li>Lines 17-30 create a taskflow of four tasks f2A, f2B, f2C, and f2D </li>
<li>Line 32 creates a module task from taskflow f1 through the method <a class="el" href="classtf_1_1FlowBuilder.html#ac6f22228d4c2ea2e643c4b0d42c0e92a" title="creates a module task for the target object">Taskflow::composed_of</a> </li>
<li>Line 33 enforces task f2C to run before the module task </li>
<li>Line 34 enforces the module task to run before task f2D</li>
</ul>
<h1><a class="anchor" id="CreateAModuleTask"></a>
Create a Module Task</h1>
<p>The task created from <a class="el" href="classtf_1_1FlowBuilder.html#ac6f22228d4c2ea2e643c4b0d42c0e92a" title="creates a module task for the target object">Taskflow::composed_of</a> is a <em>module</em> task that runs on a pre-defined taskflow. A module task does not own the taskflow but maintains a soft mapping to the taskflow. You can create multiple module tasks from the same taskflow but only one module task can run at one time. For example, the following composition is valid. Even though the two module tasks <code>module1</code> and <code>module2</code> refer to the same taskflow <code>F1</code>, the dependency link prevents <code>F1</code> from multiple executions at the same time.</p>
<div class="dotgraph">
<img src="dot_composition_static_2.png" alt="dot_composition_static_2.png" border="0" usemap="#dot_composition_static_2.map"/>
</div>
<p>However, the following composition is <em>invalid</em>. Both module tasks refer to the same taskflow. They can not run at the same time because they are associated with the same graph.</p>
<div class="dotgraph">
<img src="dot_composition_static_invalid.png" alt="dot_composition_static_invalid.png" border="0" usemap="#dot_composition_static_invalid.map"/>
</div>
<h1><a class="anchor" id="CreateACustomComposableGraph"></a>
Create a Custom Composable Graph</h1>
<p>Taskflow allows you to create a custom graph object that can participate in the scheduling using composition. To become a module task, your class <code>T</code> must define a method <code>T::graph()</code> that returns a reference to a <a class="el" href="classtf_1_1Graph.html" title="class to create a graph object">tf::Graph</a> object. The following example defines a custom graph object that can be assembled in a taskflow throw composition:</p>
<div class="fragment"><div class="line"> 1: <span class="keyword">struct </span>CustomGraph {</div>
<div class="line"> 2:   <a class="code hl_class" href="classtf_1_1Graph.html">tf::Graph</a> graph;</div>
<div class="line"> 3:   CustomGraph() {</div>
<div class="line"> 4:     <a class="code hl_class" href="classtf_1_1FlowBuilder.html">tf::FlowBuilder</a> builder(graph);</div>
<div class="line"> 5:     <a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> task = builder.emplace([](){</div>
<div class="line"> 6:       <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;a task\n&quot;</span>;  <span class="comment">// static task</span></div>
<div class="line"> 7:     });</div>
<div class="line"> 8:   }</div>
<div class="line"> 9:   <span class="comment">// returns a reference to the graph for taskflow composition</span></div>
<div class="line">10:   Graph&amp; graph() { <span class="keywordflow">return</span> graph; }</div>
<div class="line">11: };</div>
<div class="line">12:</div>
<div class="line">13: CustomGraph obj;</div>
<div class="line">14: <a class="code hl_class" href="classtf_1_1Task.html">tf::Task</a> comp = taskflow.<a class="code hl_function" href="classtf_1_1Task.html#ab38be520fe700cb4ca1f312308a95585">composed_of</a>(obj);</div>
<div class="ttc" id="aclasstf_1_1FlowBuilder_html"><div class="ttname"><a href="classtf_1_1FlowBuilder.html">tf::FlowBuilder</a></div><div class="ttdoc">class to build a task dependency graph</div><div class="ttdef"><b>Definition</b> flow_builder.hpp:21</div></div>
<div class="ttc" id="aclasstf_1_1Graph_html"><div class="ttname"><a href="classtf_1_1Graph.html">tf::Graph</a></div><div class="ttdoc">class to create a graph object</div><div class="ttdef"><b>Definition</b> graph.hpp:56</div></div>
<div class="ttc" id="aclasstf_1_1Task_html_ab38be520fe700cb4ca1f312308a95585"><div class="ttname"><a href="classtf_1_1Task.html#ab38be520fe700cb4ca1f312308a95585">tf::Task::composed_of</a></div><div class="ttdeci">Task &amp; composed_of(T &amp;object)</div><div class="ttdoc">creates a module task from a taskflow</div><div class="ttdef"><b>Definition</b> task.hpp:436</div></div>
</div><!-- fragment --><p>Debrief:</p><ul>
<li>Lines 1-11 define a custom graph interface to participate in taskflow composition</li>
<li>Line 2 defines the graph object using <a class="el" href="classtf_1_1Graph.html" title="class to create a graph object">tf::Graph</a></li>
<li>Lines 3-8 defines the constructor that constructs the task graph using <a class="el" href="classtf_1_1FlowBuilder.html" title="class to build a task dependency graph">tf::FlowBuilder</a></li>
<li>Line 10 defines the required method for taskflow composition</li>
<li>Lines 13-14 creates a module task for the declared graph object in the taskflow</li>
</ul>
<p>The composition method <a class="el" href="classtf_1_1FlowBuilder.html#ac6f22228d4c2ea2e643c4b0d42c0e92a" title="creates a module task for the target object">tf::Taskflow::composed_of</a> requires the target to define the <code>graph()</code> method that returns a reference to a <a class="el" href="classtf_1_1Graph.html" title="class to create a graph object">tf::Graph</a> object defined by the target. At runtime, the executor will run dependent tasks in that graph using the same work-stealing scheduling algorithm as other taskflows. Taskflow leverages this powerful feature to design high-level algorithms, such as <a class="el" href="classtf_1_1Pipeline.html" title="class to create a pipeline scheduling framework">tf::Pipeline</a>.</p>
<dl class="section note"><dt>Note</dt><dd>While Taskflow gives you the flexibility to create a composable graph object, you should consider using <a class="el" href="classtf_1_1Graph.html" title="class to create a graph object">tf::Graph</a> as an opaque data structure just to interact with the library. Additionally, as other module tasks, Taskflow does not own the lifetime of a custom composable graph object but keeps a soft mapping to it. You should keep the graph object alive during its execution. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Cookbook.html">Cookbook</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
